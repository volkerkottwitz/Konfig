<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Spracheingabe-Test</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f4f4f4; }
        .container { text-align: center; }
        #bemerkungen {
            width: 400px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #mic-button {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
        }
        #mic-button.is-recording {
            background-color: #ff4136; /* Rot, wenn die Aufnahme l√§uft */
            color: white;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Bemerkungen (mit Spracheingabe)</h2>
        <textarea id="bemerkungen" rows="5" placeholder="Klicken Sie auf das Mikrofon, um zu sprechen..."></textarea>
        <button id="mic-button">üé§ Spracheingabe starten</button>
    </div>

    <script>
        // Pr√ºfen, ob die Web Speech API im Browser verf√ºgbar ist
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;

        const micButton = document.getElementById('mic-button');
        const bemerkungenTextarea = document.getElementById('bemerkungen');

        if (recognition) {
            // Konfiguration der Spracherkennung
            recognition.continuous = false; // Nur eine √Ñu√üerung auf einmal erkennen
            recognition.lang = 'de-DE';     // Sprache auf Deutsch setzen
            recognition.interimResults = false; // Nur finale Ergebnisse verwenden

            micButton.addEventListener('click', () => {
                if (micButton.classList.contains('is-recording')) {
                    // Aufnahme stoppen, wenn sie bereits l√§uft
                    recognition.stop();
                } else {
                    // Aufnahme starten
                    try {
                        recognition.start();
                    } catch(e) {
                        alert("Fehler: Die Spracherkennung konnte nicht gestartet werden. M√∂glicherweise l√§uft sie bereits.");
                    }
                }
            });

            // Event-Handler f√ºr den Start der Aufnahme
            recognition.onstart = () => {
                micButton.classList.add('is-recording');
                micButton.textContent = 'üî¥ Aufnahme l√§uft...';
            };

            // Event-Handler f√ºr das Ende der Aufnahme
            recognition.onend = () => {
                micButton.classList.remove('is-recording');
                micButton.textContent = 'üé§ Spracheingabe starten';
            };

            // Event-Handler, wenn ein Ergebnis vorliegt
            recognition.onresult = (event) => {
                const currentText = bemerkungenTextarea.value;
                const speechResult = event.results[0][0].transcript;

                // F√ºgt das Ergebnis zum bestehenden Text hinzu (mit einem Leerzeichen)
                bemerkungenTextarea.value = currentText ? `${currentText} ${speechResult}` : speechResult;
            };

            // Event-Handler f√ºr Fehler
            recognition.onerror = (event) => {
                alert(`Fehler bei der Spracherkennung: ${event.error}`);
            };

        } else {
            // Fallback, wenn die API nicht unterst√ºtzt wird
            micButton.disabled = true;
            micButton.textContent = 'Spracheingabe nicht unterst√ºtzt';
            alert('Ihr Browser unterst√ºtzt die Web Speech API leider nicht. Bitte versuchen Sie es mit Chrome oder Edge.');
        }
    </script>

</body>
</html>