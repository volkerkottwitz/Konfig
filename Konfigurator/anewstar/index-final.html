<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>DUOVIEWER – EWE Preisliste (Final)</title>
  <link rel="manifest" href="manifest1.json">
  <link rel="apple-touch-icon" href="images/ewe-icon-180.png">
  <link rel="icon" href="images/ewe-icon-32.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles-final.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  
</head>
<body>

  <!-- Weißer Ladebildschirm mit pulsierendem PNG -->
<div id="loadingScreen">
  <img src="images/ewe-icon-180.png" alt="Lade..." class="loading-logo">
</div>

<!-- ======================================================= -->
<!--         START: Überarbeiteter und geordneter Header         -->
<!-- ======================================================= -->
<div id="header">

  <!-- 1. Linker Bereich: Logo -->
  <div class="header-left">
    <a href="https://www.ewe-armaturen.de" 
       target="_blank" 
       rel="noopener" 
       data-tooltip="Zur EWE-Armaturen Webseite">
      <img src="images/logo.png" alt="EWE Logo">
    </a>
  </div>

  <!-- 2. Mittlerer Bereich: Titel der App und aktuelles Dokument -->
  <div class="header-center-title">
    <h1 class="main-title" onclick="resetApplication()" style="cursor: pointer;" data-tooltip="Anwendung neu starten">DuoViewer</h1>
    <div id="document-display-container">
      <span id="current-document-name" title="Aktuell geöffnetes Dokument"></span>
    </div>
  </div>

  <!-- 3. Rechter Bereich: Alle Icons und Buttons -->
  <div class="header-right">
    
    


    <!-- Buttons, die nur auf dem Desktop sichtbar sind -->
    <div class="buttons desktop-buttons">
      
      <button id="openDocDialogBtn" class="header-icon-btn" data-tooltip="Dokumentauswahl anzeigen">
        <i class="bi bi-collection"></i>
      </button>

<button type="button" id="desktop-merkliste-btn" onclick="openMerkliste()" class="header-icon-btn" data-tooltip="Merkliste anzeigen">
  <span class="badge-anchor"> <!-- Das ist der neue Anker -->
    <i class="bi bi-list-check"></i>
  </span>
</button>



<!-- DEAKTIVIERT: Bericht diktieren (bei Bedarf wieder einkommentieren)
<button type="button"
        onclick="openBerichte(event)"
        class="header-icon-btn"
        data-tooltip="Bericht diktieren">
  <i class="bi bi-mic-fill"></i>
</button>
-->


      <a href="megaripp.html"
         class="header-icon-btn"
         data-tooltip="Konfigurator MEGARIPP"
         target="_blank"
         rel="opener">
        <i class="bi bi-box-seam"></i>
      </a>

      <a href="flexoripp.html"
         class="header-icon-btn"
         data-tooltip="Konfigurator FLEXORIPP"
         target="_blank"
         rel="noopener">
        <i class="bi bi-gear-wide-connected"></i>
      </a>

      <a href="https://www.youtube.com/watch?v=0_29ByAIswI" 
         class="header-icon-btn" 
         target="_blank" 
         rel="noopener noreferrer" 
         data-tooltip="EWE-Youtube Kanal">
        <i class="bi bi-film"></i>
      </a>

      <!-- FÜGEN SIE DEN FOLGENDEN BLOCK HIER EIN -->
<!-- ======================================================= -->
<!-- NEU: Login/Logout Buttons                             -->
<!-- ======================================================= -->
<div id="auth-controls">
    <button id="loginBtn" class="header-icon-btn" data-tooltip="Anmelden für Freigabe Kundendatenbank">
        <i class="bi bi-lock-fill"></i>
    </button>
    <button id="logoutBtn" class="header-icon-btn" data-tooltip="Abmelden" style="display: none;">
        <i class="bi bi-box-arrow-right"></i>
    </button>
</div>
<!-- ======================================================= -->

    </div>

    <!-- Hamburger-Button, der nur auf mobilen Geräten sichtbar ist -->
    <button id="hamburger-btn" class="icon-button">☰</button>
  </div>

</div>
<!-- ======================================================= -->
<!--          ENDE: Überarbeiteter und geordneter Header         -->
<!-- ======================================================= -->


<!-- Das mobile Navigationsmenü (außerhalb des Headers  ) -->
<!-- Das mobile Navigationsmenü (außerhalb des Headers) -->
<div id="mobile-nav">
  <!-- Dokumentenauswahl für Mobile -->
  <a href="#" onclick="document.getElementById('openDocDialogBtn').click(); closeMobileNav(); return false;">
    <i class="bi bi-collection"></i> Dokumente wechseln
  </a>
  
  <!-- Merkliste -->
  <a href="#" id="mobile-nav-merkliste" onclick="openMerkliste(); closeMobileNav(); return false;">
    <i class="bi bi-list-check"></i> Merkliste
  </a>

  <!-- DEAKTIVIERT: Bericht diktieren (bei Bedarf wieder einkommentieren)
  <a href="#" onclick="openBerichte(event); closeMobileNav();">
    <i class="bi bi-mic-fill"></i> Bericht diktieren
  </a>
  -->

  <!-- Konfiguratoren -->
  <a href="megaripp.html" target="_blank" rel="opener" onclick="closeMobileNav()">
    <i class="bi bi-gear-wide-connected"></i> Konfigurator MEGARIPP
  </a>
  <a href="flexoripp.html" target="_blank" rel="noopener" onclick="closeMobileNav()">
    <i class="bi bi-sliders"></i> Konfigurator FLEXORIPP
  </a>

  <!-- YouTube-Link -->
  <a href="https://www.youtube.com/watch?v=0_29ByAIswI" target="_blank" rel="noopener noreferrer" onclick="closeMobileNav( )">
    <i class="bi bi-film"></i> EWE-Youtube Kanal
  </a>

  <!-- ======================================================== -->
  <!--     NEU: PLATZHALTER FÜR DEN MOBILEN AUTH-LINK           -->
  <!-- ======================================================== -->
  <a href="#" id="mobileAuthLink" style="margin-top: 10px; padding-top: 20px;">
    <!-- Inhalt wird dynamisch per JavaScript gesetzt -->
  </a>
  <!-- ======================================================== -->

</div>



<div class="search-container">
  <div class="search-primary-row">
    <input type="text" id="searchBox" placeholder="Suchbegriff eingeben" data-tooltip="Ersten Suchbegriff eingeben">
    <button id="toggle-advanced-search" class="toggle-advanced-btn" data-tooltip="Erweiterte Suche"><i class="bi bi-chevron-down"></i></button>
  </div>

  <!-- Erweiterte Suche: Operatoren + 2. Suchfeld (Mobile einklappbar) -->
  <div id="advanced-search-section" class="advanced-search-section">
    <div id="search-operator-group" class="search-operator-group">
      <button class="operator-btn active" data-op="und" data-tooltip="Zeigt nur Seiten, auf denen BEIDE Begriffe vorkommen">UND</button>
      <button class="operator-btn" data-op="oder" data-tooltip="Zeigt Seiten, auf denen MINDESTENS EINER der Begriffe vorkommt">ODER</button>
      <button class="operator-btn" data-op="ohne" data-tooltip="Zeigt Seiten, die den ersten, aber NICHT den zweiten Begriff enthalten">OHNE</button>
    </div>
    <input type="text" id="searchBox2" placeholder="Suchbegriff 2 (verknuepft)" data-tooltip="Zweiten Suchbegriff eingeben (optional)">
  </div>

  <div class="button-row">
    <button id="local-search-btn" class="icon-button" data-tooltip="Nur im aktuellen Dokument suchen (Enter)"><i class="bi bi-search"></i></button>
    <button id="global-search-btn" class="icon-button" data-tooltip="Alle Dokumente durchsuchen"><i class="bi bi-globe2"></i></button>
    <button id="print-current-btn" class="icon-button" data-tooltip="Aktuelle Seite drucken"><i class="bi bi-printer"></i></button>
    <button id="print-matches-btn" class="icon-button" data-tooltip="Alle Treffer drucken"><i class="bi bi-files"></i></button>
  </div>
</div>


  <div id="loadingSpinnerOverlay">
    <img src="images/ewe-icon-180.png" class="rotating-logo" alt="Lädt…">
  </div>
</div>

<div id="infoSection">
  <div id="searchStatus">
    <span id="searchInfo"></span>
    <span id="currentMatchInfo"></span>
    <span id="page-info"></span> <!-- Hier kommt die Seitenzahl rein -->
    <span id="lazy-load-status" style="display: none;" data-tooltip="Dokumente werden für die Suche vorbereitet. Sie können bereits arbeiten."></span>

  </div>
  <div id="progressBar"><div id="progressFill"></div></div>
</div>

<div class="navigation-buttons">
  <!-- Gruppe 1: PDF-Seiten-Navigation -->
  <div class="nav-group nav-group-pages">
    <button id="prev-page" data-tooltip="Vorherige Seite"><i class="bi bi-chevron-left"></i> <span class="nav-button-text">PDF</span></button>
    <button id="next-page" data-tooltip="Naechste Seite"><span class="nav-button-text">PDF</span> <i class="bi bi-chevron-right"></i></button>
  </div>

  <!-- Gruppe 2: Treffer-Navigation -->
  <div class="nav-group nav-group-matches">
    <button onclick="prevMatch()" class="match-nav-btn" data-tooltip="Vorheriger Treffer" disabled><i class="bi bi-chevron-left"></i></button>
    <span class="match-nav-label">Treffer</span>
    <button onclick="nextMatch()" class="match-nav-btn" data-tooltip="Naechster Treffer" disabled><i class="bi bi-chevron-right"></i></button>
  </div>

  <!-- Gruppe 3: Zoom (nur Desktop) -->
  <div class="zoom-group">
    <button onclick="zoomOut()" data-tooltip="Verkleinern"><i class="bi bi-zoom-out"></i></button>
    <button onclick="zoomIn()" data-tooltip="Vergroessern"><i class="bi bi-zoom-in"></i></button>
  </div>
</div>



  <div id="pdfContainer">
    <button id="removeHitBtn" style="display: none;" data-tooltip="Diese Seite aus Ihrer Druckmappe entfernen. So können Sie die Auswahl reduzieren."><i class="bi bi-dash-circle"></i> <span class="hit-btn-text">Entfernen</span></button>
    <button id="addHitBtn" style="display: none;" data-tooltip="Diese Seite zur Druckmappe hinzufügen. Ideal, um einzelne Seiten für Kunden zusammenzustellen."><i class="bi bi-plus-circle"></i> <span class="hit-btn-text">Hinzufügen</span></button>
    <div id="pdfViewer"></div>
  </div>

<!-- Info Modal -->
<div id="infoModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
     background-color: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:white; padding:25px 30px; border-radius:10px; max-width:400px; text-align:center; font-family: Arial, sans-serif;">
    <h2>Information</h2>
    <p>Diese Anwendung wurde für <br><br><strong>Wilhelm Ewe Armaturen GmbH & Co.KG</strong><br></p>
    <p>entwickelt.<br><br>Es handelt sich<br>um die <strong>Beta-Version 1.212505 (Final)</strong>.</p>
    <p>Programmfehler bitte melden an: <br>
      <a href="mailto:volker.kottwitz@ewe-armaturen.de">volker.kottwitz@ewe-armaturen.de</a>
    </p>
    <button onclick="closeInfo()" style="margin-top:15px; padding:8px 16px; border:none; background-color:#00a1e1; color:white; border-radius:5px;">Schließen</button>
  </div>
</div>

<!-- Dynamische Merkliste -->
<div id="merkliste" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
     background-color: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 9999;">
  
  <div style="background:#fefefe; padding:25px 30px; border-radius:14px; max-width:450px; width:90%; font-family: 'Segoe UI', sans-serif; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
      <h2 style="margin: 0; font-size: 1.4rem;"><i class="bi bi-list-check"></i> Ihre Merkliste</h2>
      <button onclick="schließeMerkliste()" style="background:none; border:none; font-size:22px; cursor:pointer; color:#333;">✖</button>
    </div>

    <ul id="merklisteInhalt" style="list-style:none; padding:0; margin: 20px 0; max-height: 300px; overflow-y:auto;">
      <!-- Dynamische Artikel werden hier eingefügt -->
    </ul>

    <button class="btn-kaufen" style="width:100%; padding:12px; background:#00a1e1; color:white; border:none; border-radius:8px; font-size:1rem; margin-bottom:10px; cursor:pointer;">
      Jetzt bestellen
    </button>

    <button onclick="schließeMerkliste()" style="width:100%; padding:10px; background:#e0e0e0; color:#333; border:none; border-radius:8px; font-size:0.95rem; cursor:pointer;">
      Schließen
    </button>
  </div>
</div>

  <script src="viewer-final.js"></script>
  
 <script src="retourenschein-extension.js"></script>

<!-- Dokumenten-Auswahl-Dialog -->
<div id="docDialog" style="display: none;">
  <div class="doc-dialog-header">
    <h2>Dokument auswählen</h2>
    <button id="closeDocDialogBtn" title="Schließen">✖</button>
  </div>
  <div id="docDialogList">
    <!-- Die Liste der Dokumente wird hier per JavaScript eingefügt -->
  </div>
</div>

<!-- ======================================================= -->
<!-- NEU: Professioneller Passwort-Dialog (versteckt)      -->
<!-- ======================================================= -->
<div id="password-dialog-overlay" style="display:none;">
    <div class="login-card">
        <img src="images/logo.png" alt="EWE Firmenlogo" class="login-logo">
        
        <h2>Kundendaten freigeben</h2>
        <p>Bitte geben Sie das Passwort für die Kundendatenbank ein.</p>
        
        <div class="input-wrapper">
            <input type="password" id="passwordInput" placeholder="Passwort" autofocus>
        </div>
        
        <p id="status" class="status-message"></p>
        
        <button id="submitButton" class="btn-login">Freigabe Kundendaten</button>
        <button id="cancelLoginBtn" class="btn-secondary">Ohne Anmeldung fortfahren</button>
    </div>
</div>
<!-- ======================================================= -->

<!-- ======================================================= -->
<!-- NEU: Globales Suchergebnis-Overlay                    -->
<!-- ======================================================= -->
<div id="global-search-overlay" style="display: none;">
  <div class="global-search-modal">
    <div class="global-search-header">
      <i class="bi bi-globe2"></i>
      <h2 id="global-search-title">Suchergebnisse</h2>
      <button id="close-search-overlay-btn" title="Schliessen"><i class="bi bi-x-lg"></i></button>
    </div>
    <div id="global-search-results-container">
      <!-- Die Ergebnisse werden hier dynamisch eingefuegt -->
    </div>
  </div>
</div>

</body>
</html>